name: Publish Base Images

on:
  # Nightly builds at 2 AM UTC
  schedule:
    - cron: '0 2 * * *'
  # On changes to Dockerfiles or the bake workflow
  push:
    branches: [main, dev]
    paths:
      - '.docker/**'
      - '.github/workflows/_publish-docker-bake.yaml'
      - '.github/workflows/publish-base-images.yaml'
  pull_request:
    paths:
      - '.docker/**'
      - '.github/workflows/_publish-docker-bake.yaml'
      - '.github/workflows/publish-base-images.yaml'
  # Manual trigger
  workflow_dispatch:

jobs:
  publish:
    uses: ./.github/workflows/_publish-docker-bake.yaml
    with:
      registry: dockerhub
      bake_file: .docker/docker-bake.hcl
      # Build all targets in default group (ubuntu-22-dev, ubuntu-24-dev)
      # Image names come from the bake file itself
      bake_targets: ""
    secrets:
      DOCKERHUB_USER: ${{ secrets.DOCKERHUB_USER }}
      DOCKERHUB_TOKEN: ${{ secrets.DOCKERHUB_TOKEN }}
